<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE metadata-config PUBLIC "-//persist4j/Metadata 0.3"
		"https://raw.githubusercontent.com/devezhao/persist4j/master/src/main/resources/metadata.dtd">
<metadata-config schema-name-optimize="true" default-parent="SystemCommon">

	<entity name="SystemCommon" type-code="000">
		<field name="createdBy" type="reference" ref-entity="User" nullable="false" creatable="false" updatable="false" description="创建人" />
		<field name="createdOn" type="timestamp" nullable="false" creatable="false" updatable="false" description="创建时间" />
		<field name="modifiedBy" type="reference" ref-entity="User" nullable="false" creatable="false" updatable="false" description="修改人" />
		<field name="modifiedOn" type="timestamp" nullable="false" creatable="false" updatable="false" description="修改时间" />
	</entity>
	
	<entity name="User" type-code="001" description="用户" name-field="fullName">
		<field name="userId" type="primary" />
		<field name="loginName" type="string" max-length="100" nullable="false" updatable="false" description="登录名" />
		<field name="password" type="string" max-length="100" nullable="false" updatable="false" description="登录密码" />
		<field name="email" type="string" max-length="100" description="邮箱" />
		<field name="fullName" type="string" max-length="100" description="姓名" />
		<field name="avatarUrl" type="string" max-length="300" description="头像" />
		<field name="jobTitle" type="string" max-length="100" description="职务" />
		<field name="deptId" type="reference" ref-entity="Department" cascade="remove-links" updatable="false" description="部门" />
		<field name="roleId" type="reference" ref-entity="Role" cascade="remove-links" updatable="false" description="角色" />
		<field name="isDisabled" type="bool" default-value="F" description="是否停用" />
		<field name="quickCode" type="string" max-length="70"/>
		<index type="unique" field-list="loginName" />
		<index type="unique" field-list="email" />
	</entity>

	<entity name="Department" type-code="002" description="部门" name-field="name">
		<field name="deptId" type="primary" />
		<field name="name" type="string" max-length="100" nullable="false" description="部门名称" />
		<field name="parentDept" type="reference" ref-entity="Department" cascade="remove-links" description="父级部门" />
		<field name="isDisabled" type="bool" default-value="F" description="是否停用" />
		<field name="quickCode" type="string" max-length="70"/>
	</entity>

	<entity name="Role" type-code="003" description="角色" name-field="name">
		<field name="roleId" type="primary" />
		<field name="name" type="string" max-length="100" nullable="false" description="角色名称" />
		<field name="isDisabled" type="bool" default-value="F" description="是否停用" />
		<field name="quickCode" type="string" max-length="70"/>
	</entity>

	<entity name="RolePrivileges" type-code="004" parent="false">
		<field name="privilegesId" type="primary" />
		<field name="roleId" type="reference" ref-entity="Role" cascade="delete" nullable="false" updatable="false" />
		<field name="entity" type="int" default-value="0" nullable="false" updatable="false" description="哪个实体" />
		<field name="zeroKey" type="string" max-length="50" description="其他权限KEY" />
		<field name="definition" type="string" max-length="100" description="权限定义" />
		<index type="unique" field-list="roleId,entity,zeroKey" />
	</entity>

	<entity name="RoleMember" type-code="005" parent="false">
		<field name="memberId" type="primary" />
		<field name="roleId" type="reference" ref-entity="Role" />
		<field name="userId" type="reference" ref-entity="User" />
	</entity>

	<entity name="MetaEntity" type-code="010" name-field="entityName">
		<field name="entityId" type="primary" />
		<field name="typeCode" type="small-int" nullable="false" updatable="false" />
		<field name="entityName" type="string" max-length="100" nullable="false" updatable="false" />
		<field name="physicalName" type="string" max-length="100" nullable="false" updatable="false" />
		<field name="entityLabel" type="string" max-length="100" nullable="false" description="for description" />
		<field name="comments" type="string" max-length="200" />
		<field name="icon" type="string" max-length="60" />
		<field name="nameField" type="string" max-length="100" />
		<field name="masterEntity" type="string" max-length="100" updatable="false" description="明细实体的所属主实体" />
		<index type="unique" field-list="typeCode" />
		<index type="unique" field-list="entityName" />
		<index type="unique" field-list="physicalName" />
	</entity>

	<entity name="MetaField" type-code="011" name-field="fieldName">
		<field name="fieldId" type="primary" />
		<field name="belongEntity" type="string" max-length="100" nullable="false" updatable="false" />
		<field name="fieldName" type="string" max-length="100" nullable="false" updatable="false" />
		<field name="physicalName" type="string" max-length="100" nullable="false" updatable="false" />
		<field name="fieldLabel" type="string" max-length="100" nullable="false" description="for description" />
		<field name="displayType" type="string" max-length="100" description="显示类型. 详见 DisplayType" />
		<field name="nullable" type="bool" default-value="T" />
		<field name="creatable" type="bool" default-value="T" />
		<field name="updatable" type="bool" default-value="T" />
		<field name="defaultValue" type="string" max-length="300" description="此值不影响数据库默认值" />
		<field name="maxLength" type="small-int" default-value="300" />
		<field name="refEntity" type="string" max-length="100" />
		<field name="cascade" type="string" max-length="20" />
		<field name="comments" type="string" max-length="300" />
		<field name="extConfig" type="string" max-length="700" description="更多扩展配置, JSON格式KV" />
		<index type="unique" field-list="belongEntity,fieldName" />
		<index type="unique" field-list="belongEntity,physicalName" />
	</entity>

	<entity name="PickList" type-code="012" name-field="text" description="下拉列表字段配置选项">
		<field name="itemId" type="primary" />
		<field name="belongEntity" type="string" max-length="100" nullable="false" updatable="false" />
		<field name="belongField" type="string" max-length="100" nullable="false" updatable="false" />
		<field name="text" type="string" max-length="100" nullable="false" />
		<field name="seq" type="int" default-value="0" description="排序, 小到大" />
		<field name="isDefault" type="bool" default-value="F" />
		<field name="isHide" type="bool" default-value="F" />
	</entity>

	<entity name="LayoutConfig" type-code="013" description="布局配置 (表单/列表/视图(相关项/新建))">
		<field name="configId" type="primary" />
		<field name="config" type="text" description="JSON格式配置" nullable="false" />
		<field name="shareTo" type="string" max-length="420" default-value="SELF" description="共享给哪些人, 可选值: ALL/SELF/$MemberID(U/D/R)" />
		<field name="belongEntity" type="string" max-length="100" nullable="false" updatable="false" />
		<field name="applyType" type="string" max-length="20" nullable="false" updatable="false" description="FORM,DATALIST,NAVI,TBA,ADD" />
	</entity>
	
	<entity name="FilterConfig" type-code="014" description="过滤条件配置">
		<field name="configId" type="primary" />
		<field name="config" type="text" description="JSON格式配置" nullable="false" />
		<field name="shareTo" type="string" max-length="420" default-value="SELF" description="共享给哪些人, 可选值: ALL/SELF/$MemberID(U/D/R)" />
		<field name="belongEntity" type="string" max-length="100" nullable="false" updatable="false" />
		<field name="filterName" type="string" max-length="100" nullable="false" />
	</entity>
	
	<entity name="DashboardConfig" type-code="016" description="仪表盘配置">
		<field name="configId" type="primary" />
		<field name="config" type="text" description="JSON格式配置" nullable="false" />
		<field name="shareTo" type="string" max-length="420" default-value="SELF" description="共享给哪些人, 可选值: ALL/SELF/$MemberID(U/D/R)" />
		<field name="title" type="string" max-length="100" nullable="false" />
	</entity>
	
	<entity name="ChartConfig" type-code="017" description="图表配置">
		<field name="chartId" type="primary" />
		<field name="config" type="text" description="JSON格式配置" nullable="false" />
		<field name="belongEntity" type="string" max-length="100" nullable="false" updatable="false" />
		<field name="chartType" type="string" max-length="100" nullable="false" />
		<field name="title" type="string" max-length="100" nullable="false" />
	</entity>
	
	<entity name="Classification" type-code="018" name-field="name" description="分类">
		<field name="dataId" type="primary" />
		<field name="name" type="string" max-length="100" nullable="false" />
		<field name="description" type="string" max-length="600" />
		<field name="isDisabled" type="bool" default-value="F" />
		<field name="openLevel" type="small-int" default-value="0"/>
	</entity>
	
	<entity name="ClassificationData" type-code="019" name-field="fullName" description="分类明细数据">
		<field name="itemId" type="primary" />
		<field name="dataId" type="reference" ref-entity="Classification" nullable="false" cascade="delete" />
		<field name="name" type="string" max-length="100" nullable="false" />
		<field name="fullName" type="string" max-length="300" nullable="false" description="包括父级名称, 用点号分割" />
		<field name="parent" type="reference" ref-entity="ClassificationData" cascade="delete" />
		<field name="code" type="string" max-length="50" />
		<field name="level" type="small-int" default-value="0" updatable="false" />
		<field name="isHide" type="bool" default-value="F" />
		<index field-list="dataId,parent"/>
		<index field-list="dataId,fullName"/>
	</entity>
	
	<entity name="ShareAccess" type-code="020" description="记录共享">
		<field name="accessId" type="primary" />
		<field name="belongEntity" type="string" max-length="100" nullable="false" updatable="false" description="哪个实体" />
		<field name="recordId" type="any-reference" nullable="false" updatable="false" description="记录ID" />
		<field name="shareTo" type="any-reference" ref-entity="User,Department,Role" nullable="false" updatable="false" description="共享给谁 (U/D/R)" />
		<field name="rights" type="int" default-value="0" nullable="false" description="共享权限 (R=2,U=4,D=8,0=Auto)" />
		<index field-list="belongEntity,recordId,shareTo" />
	</entity>

	<entity name="SystemConfig" type-code="021" parent="false" description="系统全局配置">
		<field name="configId" type="primary" />
		<field name="item" type="string" max-length="100" nullable="false" updatable="false" />
		<field name="value" type="string" max-length="600" nullable="false" />
		<index type="unique" field-list="item" />
	</entity>

	<entity name="Notification" type-code="022" description="通知消息">
		<field name="messageId" type="primary" />
		<field name="fromUser" type="reference" ref-entity="User" nullable="false" updatable="false" />
		<field name="toUser" type="reference" ref-entity="User" nullable="false" updatable="false" />
		<field name="message" type="string" max-length="1000" updatable="false" />
		<field name="relatedRecord" type="any-reference" updatable="false" description="相关业务记录" />
		<field name="unread" type="bool" default-value="T" />
		<index field-list="toUser,unread,createdOn" />
	</entity>
	
	<entity name="Attachment" type-code="023" description="附件">
		<field name="attachmentId" type="primary" />
		<field name="belongEntity" type="small-int" default-value="0" updatable="false" />
		<field name="belongField" type="string" max-length="100" updatable="false" />
		<field name="relatedRecord" type="any-reference" updatable="false" description="相关业务记录" />
		<field name="filePath" type="string" max-length="200" nullable="false" />
		<field name="fileType" type="string" max-length="20" />
		<field name="fileSize" type="int" default-value="0" description="in KB" />
		<field name="inFolder" type="reference" ref-entity="AttachmentFolder" cascade="remove-links" />
		<index field-list="belongEntity,belongField,filePath"/>
		<index field-list="relatedRecord"/>
		<index field-list="inFolder,createdOn"/>
	</entity>
	
	<entity name="AttachmentFolder" type-code="024" description="附件目录">
		<field name="folderId" type="primary" />
		<field name="name" type="string" max-length="100" nullable="false" />
		<field name="parent" type="reference" ref-entity="AttachmentFolder" />
	</entity>
	
	<entity name="LoginLog" type-code="025" parent="false" name-field="user" description="登陆日志">
		<field name="logId" type="primary"/>
		<field name="user" type="reference" ref-entity="User" nullable="false" updatable="false" description="登陆用户" />
		<field name="ipAddr" type="string" max-length="100" description="IP地址" />
		<field name="userAgent" type="string" max-length="100" description="客户端" />
		<field name="loginTime" type="timestamp" nullable="false" updatable="false" description="登陆时间" />
		<field name="logoutTime" type="timestamp" description="退出时间" />
		<index field-list="user,loginTime" />
	</entity>
	
	<entity name="AutoFillinConfig" type-code="026" description="字段自动回填配置">
		<field name="configId" type="primary" />
		<field name="belongEntity" type="string" max-length="100" nullable="false" updatable="false" />
		<field name="belongField" type="string" max-length="100" nullable="false" updatable="false" />
		<field name="sourceField" type="string" max-length="100" nullable="false" description="引用实体的字段" />
		<field name="targetField" type="string" max-length="100" nullable="false" description="当前实体的字段" />
		<field name="extConfig" type="string" max-length="700" description="更多扩展配置, JSON格式KV" />
	</entity>
	
	<entity name="RobotTriggerConfig" type-code="027" description="动作触发器">
		<field name="configId" type="primary"/>
		<field name="belongEntity" type="string" max-length="100" nullable="false" updatable="false" />
		<field name="when" type="int" default-value="0" description="动作 (累加值)" />
		<field name="whenFilter" type="text" description="附加过滤器" />
		<field name="actionType" type="string" max-length="50" nullable="false" description="预定义的触发操作类型" />
		<field name="actionContent" type="text" description="预定义的触发操作类型, JSON KV 对" />
		<field name="priority" type="int" default-value="1" description="执行优先级, 越大越高(越先执行)"/>
	</entity>
	
	<!--
	<entity name="ApporvalFields" type-code="000">
		<field name="apporvalId" type="reference" ref-entity="RobotApprovalConfig" description="审批流程" />
		<field name="apporvalState" type="small-int" default-value="0" description="审批状态" />
		<field name="apporvalStepId" type="reference" ref-entity="RobotApprovalStep" description="当前步骤" />
	</entity>
	-->
	
	<entity name="RobotApprovalConfig" type-code="028" name-field="name" description="审批流程">
		<field name="configId" type="primary"/>
		<field name="belongEntity" type="string" max-length="100" nullable="false" updatable="false" description="应用实体" />
		<field name="name" type="string" max-length="100" nullable="false" description="流程名称" />
		<field name="flowDefinition" type="text" description="流程定义" />
		<field name="isDisabled" type="bool" default-value="F" description="是否停用" />
	</entity>
	
	<entity name="RobotApprovalStep" type-code="029" description="审批步骤记录">
		<field name="stepId" type="primary"/>
		<field name="recordId" type="any-reference" nullable="false" updatable="false" cascade="delete" description="审批记录"/>
		<field name="approvalId" type="reference" ref-entity="RobotApprovalConfig" nullable="false" updatable="false" cascade="delete" description="审批流程" />
		<field name="node" type="string" max-length="100" nullable="false" updatable="false" description="审批节点" />
		<field name="approver" type="reference" ref-entity="User" nullable="false" updatable="false" cascade="delete" description="审批人" />
		<field name="state" type="small-int" default-value="1" description="审批结果" />
		<field name="remark" type="string" max-length="600" description="批注" />
		<field name="approvedTime" type="timestamp" description="审批事件" />
		<field name="prevStepId" type="reference" ref-entity="RobotApprovalStep" description="上一步骤" />
		<index field-list="recordId,approvalId"/>
	</entity>
</metadata-config>